<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <title>My App</title>
</head>
<body>

<script src="js/external/jquery-2.1.0.js"></script>
<script src="js/external/underscore.js"></script>
<script src="js/external/backbone.js"></script>

<script>
    // Your Backbone code goes here

    Book = Backbone.Model.extend({
        urlRoot: 'http://localhost:8080/books/',
        initialize: function(){
            this.on("change", function(){
                console.log('Model Changed');
            });
            this.on("change:name", function(){
                console.log('The name attribute has changed');
            });
            this.on("invalid", function(model, error) {
                console.log("**Validation Error: " + error + "**");
            });
            console.log('a new book');
        },

        defaults: {
            name: 'Book Title',
            author: 'No One'
        },

        printDetails: function(){
            console.log(this.get('name') + ' by ' + this.get('author'));
        },

        validate: function(attrs){
            if (attrs.year < 2000) {
                return 'year must be after 2000';
            }
            if (!attrs.name) {
                return 'A name must be provided';
            }
        }
    });

    var thisBook = new Book({
        name: 'Beginning Backbone',
        author: 'James Sugrue'
    });
    console.log(thisBook.get('name') + ' by ' + thisBook.get('author'));
    console.log(thisBook.attributes);
    thisBook.set('name', 'Beginning Backbone.js');
    thisBook.set('year', 2013);
    console.log('Book year ' + thisBook.get('year'));
    thisBook.unset('year');
    console.log('Book year ' + thisBook.get('year'));
    var hasYear = thisBook.has('year');
    var hasName = thisBook.has('name');
    console.log('Has an attribute called year: ' + hasYear);
    console.log('Has an attribute called name: ' + hasName);
    var newBook = new Book({
        name: 'Another Book',
        author: 'You'
    });
    newBook.clear();
    console.log('Has an attribute called name: ' + newBook.has('name'));
    var clonedBook = thisBook.clone();
    thisBook.printDetails();
    thisBook.set('year', 1992, {validate: true});

    thisBook.save(thisBook.attributes,
    {
        success: function(model, response, options){
            console.log('Model saved');
            console.log('Id: ' + thisBook.get('id'));
            console.log('Book type: ' + thisBook.get('bookType'));
        },
        error: function(model, xhr, options){
            console.log('Failed to save model');
        }
    });

    var Library = Backbone.Collection.extend({
        model: Book,
        initialize: function() {
            console.log('Creating a new library collection');
        },
        comparator: function(a, b) {
            return a.get('name') < b.get('name') ? -1 : 1;
        }
    });

    //var myLibrary = new Library();

    var bookOne = new Book({
        name: 'Beginning Backbone',
        author: 'James Sugrue'
    });

    var bookTwo = new Book({
        name: 'Pro Javascript Design Patterns',
        author: 'Dustin Diaz, Ross Harmes'
    });

    var myLibrary = new Library([bookOne, bookTwo]);
    console.log('Library contains ' + myLibrary.length + 'books');
</script>
</body>
</html>
